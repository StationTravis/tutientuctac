<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tu Tiên</title>
<style>
  :root{
    --bg:#0b0f14;
    --card:#111823;
    --text:#e6edf3;
    --muted:#9fb0c3;
    --accent:#49cc90;
    --danger:#ff6b6b;
    --warn:#ffd166;
  }
  html,body{height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";}
  .wrap{max-width:1100px;margin:24px auto;padding:16px;}
  .grid{display:grid;grid-template-columns:1.2fr 1.1fr;gap:16px;}
  .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.3);}
  h1{font-size:20px;margin:0 0 12px}
  .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .muted{color:var(--muted);font-size:12px}
  .btn{appearance:none;border:none;background:#1f2a37;color:var(--text);padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:700;transition:transform .06s ease,filter .15s}
  .btn:hover{filter:brightness(1.1)}
  .btn:active{transform:translateY(1px)}
  .btn-primary{background:#244b33}
  .btn-danger{background:#3a1b1b}
  .btn-warn{background:#3a321b}
  input,select{background:#0d141d;border:1px solid #1f2a37;color:var(--text);padding:8px 10px;border-radius:10px;min-width:80px}

  /* Scene */
  .character-wrap{position:relative;isolation:isolate; height:360px;border-radius:16px;overflow:hidden;background:radial-gradient(1200px 600px at 50% 100%, rgba(73,204,144,.08), transparent 60%)}
  .character{
    position:absolute;left:50%;top:55%;transform:translate(-50%,-50%);
    width:130px;height:180px;border-radius:16px;
    background:linear-gradient(180deg,#2f3b52 0%,#1b2433 100%);
    box-shadow:inset 0 0 40px rgba(255,255,255,.06), 0 16px 60px rgba(0,0,0,.6);
    display:flex;align-items:center;justify-content:center;
    color:#cbd5e1;font-weight:700; letter-spacing:.5px;
    animation:breath 2.6s ease-in-out infinite;
  }
  @keyframes breath{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.02)}}
  .aura{
    position:absolute;left:50%;top:55%;transform:translate(-50%,-50%);
    filter:blur(0);
    pointer-events:none;
    opacity:0;transition:opacity .25s ease;
  }
  .aura.afk{opacity:1}
  .ring{
    position:absolute;left:50%;top:55%;transform:translate(-50%,-50%);
    width:220px;height:220px;border-radius:50%;
    background:radial-gradient(circle, rgba(73,204,144,.40), rgba(73,204,144,.15) 45%, rgba(73,204,144,0) 70%);
    animation:pulse 2.5s ease-in-out infinite;
    mix-blend-mode:screen;
  }
  .ring.r2{width:300px;height:300px;animation-duration:3.3s;opacity:.6}
  .ring.r3{width:380px;height:380px;animation-duration:4.2s;opacity:.35}
  @keyframes pulse{0%,100%{filter:blur(10px);opacity:.6}50%{filter:blur(20px);opacity:1}}
  canvas.particles{
    position:absolute;inset:0;opacity:.75;mix-blend-mode:screen;pointer-events:none
  }
  .state{font-weight:700;padding:6px 10px;border-radius:999px;display:inline-block}
  .state.afk{background:rgba(73,204,144,.15);color:var(--accent)}
  .state.combat{background:rgba(255,107,107,.12);color:var(--danger)}
  .badge{background:#0d141d;padding:4px 8px;border-radius:8px;border:1px solid #1f2a37;font-size:12px}

  /* Index table styles */
  .kv{display:grid;grid-template-columns:180px 1fr;gap:6px 10px;margin-bottom:6px}
  .kv .key{font-weight:700}
  .inline-3{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center}
  .tabs{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .tab{background:#16202d;border-radius:12px;text-align:center;padding:12px;font-weight:700;cursor:pointer}
  .tab:hover{background:#244b33}
  .center{text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <h1>Trang Chính</h1>
  <div class="grid">
    <!-- LEFT: Scene + state -->
    <div class="card">
      <div class="character-wrap">
        <canvas class="particles" id="particles"></canvas>
        <div id="aura" class="aura">
          <div class="ring r1"></div>
          <div class="ring r2"></div>
          <div class="ring r3"></div>
        </div>
        <div class="character">TU LUYỆN</div>
      </div>
      <div class="row" style="margin-top:12px">
        <span class="state" id="stateTag">Đợi thao tác</span>
        <span class="badge">AFK sau <span id="afkSec">10</span>s</span>
        <span class="badge">Offline cap <span id="offCap">8</span>h</span>
        <button class="btn btn-danger" id="enterCombat">Vào Combat</button>
        <button class="btn" id="exitCombat">Thoát Combat</button>
      </div>
    </div>

    <!-- RIGHT: INDEX requested layout -->
    <div class="card">
      <h1>Chỉ Số Nhân Vật</h1>

      <div class="inline-3" style="margin-bottom:8px">
        <div><b>Tên nhân vật:</b> <span id="charName">Trần Vô Song</span></div>
        <div><b>Linh Thạch:</b> <span id="linhThach">0</span></div>
        <div><b>Vàng:</b> <span id="vang">0</span></div>
      </div>

      <div class="kv">
        <div class="key">Cảnh giới:</div><div id="realmTxt">Luyện Khí - Sơ</div>
        <div class="key">Môn phái:</div><div id="sectTxt">Vô Môn</div>
        <div class="key">Trạng thái:</div><div id="statusTxt">Nhàn rỗi</div>
        <div class="key">Linh khí nhận:</div><div><span id="qiPerMin">0</span> / phút</div>
      </div>

      <div class="center" style="margin-top:8px">
        <button class="btn btn-primary" id="breakBtn">ĐỘT PHÁ GIỚI HẠN</button>
      </div>

      <div class="badge" style="margin-top:12px">Gọi tính năng Breakthrough</div>

      <div class="card" style="margin-top:16px">
        <div class="tabs">
          <div class="tab">TRANG BỊ</div>
          <div class="tab">TÚI ĐỒ</div>
          <div class="tab">KỸ NĂNG</div>
          <div class="tab">LỊCH LUYỆN</div>
          <div class="tab">NGHỀ NGHIỆP</div>
          <div class="tab">MÔN PHÁI</div>
        </div>
      </div>
    </div>
  </div>

  <div style="margin-top:16px" class="muted">
    *AFK tu luyện kích hoạt khi không combat và không thao tác ≥10 giây. Bấm “ĐỘT PHÁ GIỚI HẠN” để gọi Breakthrough (stub).
  </div>
</div>

<script>
(function(){
  // --- State (demo) ---
  let linhKhi = 0;
  let linhKhiPerSec = 2;
  let linhKhiMult = 1.0;
  let realmMult = 1.0;
  let inCombat = false;
  let lastInputAt = Date.now();
  let lastTickAt = Date.now();
  let linhThach = 0;
  let vang = 0;
  const AFK_THRESHOLD = 10_000;
  const OFFLINE_CAP_HOURS = 8;

  // --- DOM ---
  const ui = {
    afkSec: document.getElementById('afkSec'),
    offCap: document.getElementById('offCap'),
    stateTag: document.getElementById('stateTag'),
    aura: document.getElementById('aura'),
    realm: document.getElementById('realmTxt'),
    status: document.getElementById('statusTxt'),
    qiPerMin: document.getElementById('qiPerMin'),
    lt: document.getElementById('linhThach'),
    gold: document.getElementById('vang'),
  };
  ui.afkSec.textContent = (AFK_THRESHOLD/1000).toFixed(0);
  ui.offCap.textContent = OFFLINE_CAP_HOURS.toString();

  // --- Particles ---
  const canvas = document.getElementById('particles');
  const ctx = canvas.getContext('2d');
  function resizeCanvas(){
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
  }
  new ResizeObserver(resizeCanvas).observe(canvas);
  const particles = [];
  function spawnParticle(){
    const cx = canvas.width/2, cy = canvas.height*0.58;
    const angle = Math.random()*Math.PI*2;
    const radius = 40 + Math.random()*30;
    const x = cx + Math.cos(angle)*radius;
    const y = cy + Math.sin(angle)*radius + 10;
    const p = {
      x,y,
      vx:(Math.random()-0.5)*0.3,
      vy:-0.4 - Math.random()*0.6,
      life: 60 + Math.random()*60,
      r: 1.5 + Math.random()*2.5,
      hue: 150 + Math.random()*40
    };
    particles.push(p);
  }

  // --- Helpers ---
  function onPlayerInput(){ lastInputAt = Date.now(); }
  function enterCombat(){ inCombat = true; onPlayerInput(); }
  function exitCombat(){ inCombat = false; onPlayerInput(); }
  function afkActive(now){ return !inCombat && (now - lastInputAt >= AFK_THRESHOLD); }
  function realmLabel(mult){
    const steps=[
      {m:1.00, n:'Phàm Nhân - Sơ'},
      {m:1.10, n:'Luyện Khí - Sơ'},
      {m:1.21, n:'Trúc Cơ - Sơ'},
      {m:1.33, n:'Kim Đan - Sơ'},
      {m:1.46, n:'Nguyên Anh - Sơ'},
      {m:1.61, n:'Hóa Thần - Sơ'},
      {m:1.77, n:'Luyện Hư - Sơ'},
      {m:1.95, n:'Hợp Thể - Sơ'},
      {m:2.15, n:'Đại Thừa - Sơ'},
      {m:2.36, n:'Chân Tiên - Sơ'}
    ];
    let label=steps[0].n;
    for(const s of steps){ if(mult >= s.m) label = s.n; }
    return label;
  }
  function effectivePerSec(){ return linhKhiPerSec * linhKhiMult * realmMult; }
  function format(n){ return n.toLocaleString('vi-VN'); }

  // --- UI update for index ---
  function updateIndex(now=Date.now()){
    // header currencies
    ui.lt.textContent = format(linhThach);
    ui.gold.textContent = format(vang);
    // realm + status + qi per min
    ui.realm.textContent = realmLabel(realmMult);
    const afk = afkActive(now);
    ui.status.textContent = inCombat ? 'Đang lịch luyện' : (afk ? 'Đang bế quan' : 'Nhàn rỗi');
    ui.qiPerMin.textContent = (effectivePerSec()*60).toFixed(0);
    // tag + aura
    if(inCombat){
      ui.stateTag.textContent='Combat';
      ui.stateTag.className='state combat';
    }else if(afk){
      ui.stateTag.textContent='AFK';
      ui.stateTag.className='state afk';
    }else{
      ui.stateTag.textContent='Đợi thao tác';
      ui.stateTag.className='state';
    }
    document.getElementById('aura').classList.toggle('afk', afk);
  }

  // --- Breakthrough stub ---
  function breakthrough(){
    // demo: tiêu hao 500 linh thạch để tăng realm 10%
    const cost = 500;
    if(linhThach < cost){ alert('Thiếu Linh Thạch (cần ' + cost + ')'); return; }
    linhThach -= cost;
    realmMult = +(realmMult*1.10).toFixed(2);
    updateIndex();
  }
  window.breakthrough = breakthrough;
  document.getElementById('breakBtn').addEventListener('click', breakthrough);

  // --- Controls ---
  document.getElementById('enterCombat').addEventListener('click', enterCombat);
  document.getElementById('exitCombat').addEventListener('click', exitCombat);
  ['keydown','mousedown','pointerdown','touchstart'].forEach(ev=>{
    window.addEventListener(ev, onPlayerInput, {passive:true});
  });

  // --- Main loop ---
  function loop(){
    const now = Date.now();
    const dt = Math.min((now - lastTickAt)/1000, 0.25);
    lastTickAt = now;

    // particles
    if(afkActive(now)){
      if (particles.length < 160 && Math.random() < 0.8) spawnParticle();
    } else {
      if (Math.random() < 0.3) spawnParticle();
    }
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.life -= 1;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle = `hsla(${p.hue}, 80%, 60%, ${Math.max(0,p.life/120)})`; ctx.fill();
      if(p.life<=0) particles.splice(i,1);
    }

    // idle gain
    if(afkActive(now)){
      linhKhi += effectivePerSec() * dt;
      // demo: tự chuyển 1 phần thành linh thạch mỗi 10 điểm
      if(linhKhi >= 10){ linhThach += Math.floor(linhKhi/10); linhKhi = linhKhi % 10; }
    }

    updateIndex(now);
    requestAnimationFrame(loop);
  }

  // Boot
  function init(){
    // demo seed
    linhThach = 12540; vang = 5000;
    resizeCanvas(); updateIndex(); requestAnimationFrame(loop);
  }
  init();
})();
</script>
</body>
</html>
